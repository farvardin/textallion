#!/usr/bin/env bash

# pandoc -f html -t textile --parse-raw sample.html

cat $1 \
| sed -e "s/|_\./||/g" \
| sed -e "s/^h1.\(.*\)/=\1 =/g" | sed -e "s/^h2.\(.*\)/==\1 ==/g" \
| sed -e "s/^h3.\(.*\)/===\1 ===/g" | sed -e "s/^h4.\(.*\)/====\1 ====/g" \
| sed -e "s/\*\([^ ]*[^ ]\)\*/**\1**/g" | sed -e "s|_\([^ ]*[^ ]\)_|//\1//|g" \
| sed -e "s|\-\([^ ]*[^ ]\)\-|\-\-\1\-\-|g" \
| sed -e "s|\+\([^ ]*[^ ]\)\+|__\1__|g" | sed -e "s|<u>\([^ ]*[^ ]\)</u>|__\1__|g" \
| sed -e "s|^\*\*\*\*\*\*\* |      - |g" | sed -e "s|^\*\*\*\*\*\* |     - |g" \
| sed -e "s|^\*\*\*\*\* |    - |g" | sed -e "s|^\*\*\*\* |   - |g" \
| sed -e "s|^\*\*\* |  - |g" | sed -e "s|^\*\* | - |g" | sed -e "s|^\* |- |g"\
| sed -e "s|^\*\*\*\*\*\*\# |      + |g" | sed -e "s|^\*\*\*\*\*\# |     + |g" \
| sed -e "s|^\*\*\*\*\# |    + |g" | sed -e "s|^\*\*\*\# |   + |g" \
| sed -e "s|^\*\*\# |  + |g" | sed -e "s|^\*\# | + |g"  \
| sed -e "s|^\#\#\#\#\#\#\# |      + |g" | sed -e "s|^\#\#\#\#\#\# |     + |g" \
| sed -e "s|^\#\#\#\#\# |    + |g" | sed -e "s|^\#\#\#\# |   + |g" \
| sed -e "s|^\#\#\# |  + |g" | sed -e "s|^\#\# | + |g" | sed -e "s|^\# |+ |g" \
| sed -e "s|^\#\*\# |  + |g" | sed -e "s|^\#\* | + |g"  \
| sed -e "s|<hr />|----------------------|g" \
| sed -e "s|!\(.*\)!|[\1]|g" | sed -e "s|@\(.*\)@|\`\`\1\`\`|g" \
| sed -e "s|\"\(.*\)\":\(.*\)\. |[\1 \2/]. |g" | sed -e "s|\"\(.*\)\":\(.*\)php|[\1 \2php]|g"  \
| sed -e "s|\"\(.*\)\":\(.*\)htm|[\1 \2htm]|g" | sed -e "s|\"\(.*\)\":\(.*\)html|[\1 \2html]|g"  \
| sed -e "s|\"\(.*\)\":\(.*\), |[\1 \2], |" | sed -e "s|\"\(.*\)\":\([^ ]*\)|[\1 \2]|g" \
| sed -e "s|@\(.*\)@|``\1``|g" \
| sed -e "s|bc\.|\`\`\`\n|" | sed -e "s|<blockquote>|\t|" | sed -e "s|</blockquote>|\t|"\
> $1.t2t
